<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>游戏服务价格表 - 完全匹配版</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #6c5ce7;
            --secondary: #a29bfe;
            --accent: #fd79a8;
            --dark: #2d3436;
            --light: #f7f7f7;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: var(--dark);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .main-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 36px;
            margin-bottom: 10px;
        }
        
        .update-info {
            margin-top: 15px;
            font-size: 14px;
            opacity: 0.8;
        }
        
        .price-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            padding: 30px;
        }
        
        .price-item {
            background: var(--light);
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s ease;
            border-left: 5px solid var(--accent);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .price-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .item-name {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .item-price {
            color: var(--primary);
            font-size: 22px;
            font-weight: 700;
        }
        
        .hourly-price {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 14px;
        }
        
        .hourly-price span:first-child {
            color: #666;
        }
        
        .hourly-price span:last-child {
            color: var(--accent);
            font-weight: bold;
        }
        
        .loading, .error {
            text-align: center;
            padding: 50px;
            color: var(--primary);
        }
        
        .error {
            color: #e74c3c;
        }
        
        .refresh-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 15px;
        }
        
        .contact {
            background: var(--light);
            padding: 20px;
            text-align: center;
            margin: 20px 30px 30px;
            border-radius: 10px;
        }
        
        .debug-panel {
            background: #f8f9fa;
            padding: 15px;
            margin: 0 30px;
            border-radius: 10px;
            font-size: 13px;
            border-left: 4px solid #6c5ce7;
        }
        
        .floating-elements {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        
        .floating-element {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: float 15s infinite linear;
        }
        
        @keyframes float {
            0% {
                transform: translateY(0) rotate(0deg);
            }
            50% {
                transform: translateY(-20px) rotate(180deg);
            }
            100% {
                transform: translateY(0) rotate(360deg);
            }
        }
    </style>
</head>
<body>
    <div class="floating-elements">
        <div class="floating-element" style="width: 80px; height: 80px; top: 10%; left: 5%;"></div>
        <div class="floating-element" style="width: 120px; height: 120px; top: 70%; left: 80%;"></div>
        <div class="floating-element" style="width: 60px; height: 60px; top: 40%; left: 90%;"></div>
        <div class="floating-element" style="width: 100px; height: 100px; top: 20%; left: 70%;"></div>
        <div class="floating-element" style="width: 70px; height: 70px; top: 80%; left: 10%;"></div>
    </div>
    
    <div class="container">
        <div class="main-card">
            <div class="header">
                <h1><i class="fas fa-gamepad"></i> 游戏服务价格表</h1>
                <p>GitHub Gist远程控制 · 智能匹配版</p>
                <div class="update-info">
                    最后更新: <span id="last-update">-</span>
                    <span id="auto-update-info"></span>
                </div>
            </div>
            
            <div class="debug-panel">
                <p><strong>数据状态:</strong> <span id="data-status">正在检测数据结构...</span></p>
                <p id="raw-data" style="display: none;"></p>
            </div>
            
            <div id="price-content">
                <div class="loading">
                    <i class="fas fa-spinner fa-spin fa-2x"></i>
                    <p>正在分析Gist数据结构并加载价格...</p>
                </div>
            </div>
            
            <div class="contact">
                <p>联系方式: qwq_xiao_wang</p>
                <a href="http://t.cn/AXhH8Dy3" style="color: var(--primary); text-decoration: none;">点击联系</a>
            </div>
        </div>
    </div>

    <script>
        // 配置
        const CONFIG = {
            gistUrl: 'https://gist.githubusercontent.com/lixiangw872-cloud/8315551bd33b8ea7ba22431f3b4a6b9c/raw/b96b280bb628873b755859a4cb1ffb5bf9fc7553/prices.json',
            corsProxies: [
                'https://corsproxy.io/?',
                'https://api.allorigins.win/raw?url=',
                'https://api.codetabs.com/v1/proxy/?quest='
            ],
            refreshInterval: 30000,
        };

        // 更新状态显示
        function updateStatus(message) {
            document.getElementById('data-status').textContent = message;
        }

        // 显示原始数据（用于调试）
        function showRawData(data) {
            const rawDataElement = document.getElementById('raw-data');
            rawDataElement.textContent = 'Gist原始数据: ' + JSON.stringify(data, null, 2);
            rawDataElement.style.display = 'block';
        }

        // 从GitHub Gist获取价格数据
        async function fetchPrices() {
            let lastError = null;
            
            for (let i = 0; i < CONFIG.corsProxies.length; i++) {
                const proxy = CONFIG.corsProxies[i];
                try {
                    updateStatus(`尝试代理 ${i + 1}/${CONFIG.corsProxies.length}`);
                    
                    const proxyUrl = proxy + encodeURIComponent(CONFIG.gistUrl);
                    const url = proxyUrl + '&t=' + new Date().getTime();
                    
                    const response = await fetch(url);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP错误: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    updateStatus(`代理 ${i + 1} 工作正常，开始分析数据结构`);
                    return data;
                } catch (error) {
                    lastError = error;
                    console.warn(`代理 ${i + 1} 失败:`, error.message);
                    continue;
                }
            }
            
            throw new Error(`所有代理尝试均失败。最后错误: ${lastError?.message}`);
        }

        // 智能解析价格数据 - 尝试多种可能的字段名
        function parsePrices(data) {
            updateStatus("分析数据结构中...");
            
            // 显示原始数据用于调试
            showRawData(data);
            
            // 尝试多种可能的字段名组合
            const priceMappings = [
                // 英文键名
                {
                    wolf: data.wolf || data.Wolf || data.wolf_price,
                    earthDragon: data.earthDragon || data.earth_dragon || data.EarthDragon,
                    heavenKing: data.heavenKing || data.heaven_king || data.HeavenKing,
                    walkieTalkie: data.walkieTalkie || data.walkie_talkie || data.WalkieTalkie,
                    defibrillator: data.defibrillator || data.Defibrillator,
                    gun: data.gun || data.Gun,
                    sprayPack: data.sprayPack || data.spray_pack || data.SprayPack,
                    farming: data.farming || data.Farming || data.daigan,
                    ancientCity: data.ancientCity || data.ancient_city || data.AncientCity,
                    ancientCityHourly: data.ancientCityHourly || data.ancient_city_hourly,
                    kunlun: data.kunlun || data.Kunlun,
                    kunlunHourly: data.kunlunHourly || data.kunlun_hourly,
                    flyFour: data.flyFour || data.fly_four || data.FlyFour,
                    flyFourHourly: data.flyFourHourly || data.fly_four_hourly,
                    flyTwo: data.flyTwo || data.fly_two || data.FlyTwo,
                    flyTwoHourly: data.flyTwoHourly || data.fly_two_hourly,
                    star: data.star || data.Star
                },
                // 中文键名
                {
                    wolf: data.狼,
                    earthDragon: data.地龙,
                    heavenKing: data.天王,
                    walkieTalkie: data.对讲机,
                    defibrillator: data.旧版除颤,
                    gun: data.枪,
                    sprayPack: data.喷包,
                    farming: data.代肝,
                    ancientCity: data.极限古城,
                    ancientCityHourly: data.极限古城小时价,
                    kunlun: data.噩梦昆仑,
                    kunlunHourly: data.噩梦昆仑小时价,
                    flyFour: data.四队飞天,
                    flyFourHourly: data.四队飞天小时价,
                    flyTwo: data.双飞天陪,
                    flyTwoHourly: data.双飞天陪小时价,
                    star: data.蹭星
                }
            ];
            
            // 查找包含最多数据的映射
            let bestMatch = { found: 0, data: {} };
            
            for (const mapping of priceMappings) {
                let foundCount = 0;
                const validData = {};
                
                for (const key in mapping) {
                    if (mapping[key]) {
                        foundCount++;
                        validData[key] = mapping[key];
                    }
                }
                
                if (foundCount > bestMatch.found) {
                    bestMatch = { found: foundCount, data: validData };
                }
            }
            
            updateStatus(`找到 ${bestMatch.found} 个价格项目`);
            return bestMatch.found > 0 ? bestMatch.data : null;
        }

        // 渲染价格页面
        function renderPrices(priceData, rawData) {
            const content = document.getElementById('price-content');
            const lastUpdate = document.getElementById('last-update');
            
            if (!priceData || Object.keys(priceData).length === 0) {
                updateStatus("未找到有效的价格数据");
                content.innerHTML = `
                    <div class="error">
                        <i class="fas fa-exclamation-triangle fa-2x"></i>
                        <p>无法从Gist中提取价格数据</p>
                        <p>检测到的数据结构:</p>
                        <div style="text-align: left; background: #fff; padding: 15px; border-radius: 5px; margin: 15px 0; max-height: 300px; overflow: auto;">
                            <pre>${JSON.stringify(rawData, null, 2)}</pre>
                        </div>
                        <p>请确保Gist使用正确的JSON格式并包含价格信息</p>
                        <button class="refresh-btn" onclick="loadPrices()">
                            <i class="fas fa-sync-alt"></i> 重新加载
                        </button>
                    </div>
                `;
                return;
            }
            
            // 更新最后更新时间
            lastUpdate.textContent = rawData.lastUpdate || new Date().toLocaleString('zh-CN');
            
            // 生成价格网格
            let html = '<div class="price-grid">';
            
            // 定义显示顺序
            const displayOrder = [
                {name: '狼', key: 'wolf'},
                {name: '地龙', key: 'earthDragon'},
                {name: '天王', key: 'heavenKing'},
                {name: '对讲机', key: 'walkieTalkie'},
                {name: '旧版除颤', key: 'defibrillator'},
                {name: '枪', key: 'gun'},
                {name: '喷包', key: 'sprayPack'},
                {name: '代肝/投喂', key: 'farming'},
                {name: '极限古城', key: 'ancientCity', hourly: 'ancientCityHourly'},
                {name: '噩梦昆仑', key: 'kunlun', hourly: 'kunlunHourly'},
                {name: '四队飞天', key: 'flyFour', hourly: 'flyFourHourly'},
                {name: '双飞天陪', key: 'flyTwo', hourly: 'flyTwoHourly'},
                {name: '蹭星', key: 'star'}
            ];
            
            let foundItems = 0;
            displayOrder.forEach(item => {
                if (priceData[item.key]) {
                    foundItems++;
                    html += `
                        <div class="price-item">
                            <div class="item-name">${item.name}</div>
                            <div class="item-price">${priceData[item.key]}</div>
                            ${item.hourly && priceData[item.hourly] ? 
                                `<div class="hourly-price">
                                    <span>小时价:</span>
                                    <span>${priceData[item.hourly]}</span>
                                </div>` : ''}
                        </div>
                    `;
                }
            });
            
            html += '</div>';
            content.innerHTML = html;
            
            updateStatus(`成功显示 ${foundItems} 个价格项目`);
        }

        // 加载价格数据
        async function loadPrices() {
            try {
                const rawData = await fetchPrices();
                const priceData = parsePrices(rawData);
                renderPrices(priceData, rawData);
            } catch (error) {
                console.error('加载价格失败:', error);
                updateStatus('加载失败: ' + error.message);
                document.getElementById('price-content').innerHTML = `
                    <div class="error">
                        <i class="fas fa-exclamation-triangle fa-2x"></i>
                        <p>加载失败: ${error.message}</p>
                        <button class="refresh-btn" onclick="loadPrices()">
                            <i class="fas fa-sync-alt"></i> 重新加载
                        </button>
                    </div>
                `;
            }
        }

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            loadPrices();
            
            // 设置自动刷新
            setInterval(loadPrices, CONFIG.refreshInterval);
            
            // 显示自动刷新提示
            document.getElementById('auto-update-info').textContent = 
                ` (自动刷新: ${CONFIG.refreshInterval / 1000}秒)`;
        });
    </script>
</body>
</html>